##############START update_std_txt ###############	

@std.route('/update_std_txt', methods=['POST'])
@login_required
def update_std_txt():
    
    #FROM https://stackoverflow.com/questions/43811779/use-many-submit-buttons-in-the-same-form
        
    std_txt = Std_general_txt.query.filter(Std_general_txt.selected==True).first()
       
    if std_txt == None:
        flash("Please select a student and a txt to match  first ")
        return redirect(url_for('students.edit_student_destinations'))		
    
    gt = std_txt.general_txt
    
    ''' 
    gt_tag_name = "tag"+ str(std_txt.general_txt_id)    
    gt_ar_name = "ar" + str(std_txt.general_txt_id)
    '''    
    
    gt_sts_name = "sts"+ str(std_txt.general_txt_id)
    
    gt_due_date_name = "due_date" + str(std_txt.general_txt_id)
    
    gt_who_name = "who"+ str(std_txt.general_txt_id)
           
    ##import pdb; #pdb.set_trace()

    print("")
    print("")
     
    print("")
    print("")
    

    selected_gt_status = Status.query.filter(Status.color_txt==request.form[gt_sts_name]).first()    
    if selected_gt_status != None:
        std_txt.status_id = selected_gt_status.id     
    sts = set_gt_category(gt.id, 'Status', selected_gt_status.title, 'יש לבחוק סטאטוס לטקסט')  , 
    
    if gt.type=='accupation':   # Only in case of todo there is a who button
        selected_gt_who = Accupation.query.filter(Accupation.title==request.form[gt_who_name]).first()    
        if selected_gt_who != None:
            std_txt.who_id = selected_gt_who.id     
        who = set_gt_category(gt.id, 'Accupation', selected_gt_who.title, 'יש לבחור תפקיד האחראי על המשימה')  , 
    
    gt_due_date = request.form[gt_due_date_name]                
    if gt_due_date != None:
        std_txt.due_date = gt_due_date
    #gt.due_date = gt_due_date
     
    std_txt.selected = False
        
    db.session.commit()
        
    return  redirect(url_for('students.edit_student_destinations')) 

@std.route('/update_std_txt2', methods=['GET', 'POST'])
@login_required
def update_std_txt2():
    
    std = Student.query.filter(Student.selected==True).first()
     
    gt_id = int(request.form['txt_type_form_button_name'])
    
    print("request.form['txt_type_form_button_name'] ", gt_id)
    
    if gt_id == 0 or "tag_submit_btn":   # TAG OR ( TAG AND AR SELECTION  )  
        print("")
        print("request.form['selected_tag']", request.form['selected_tag'])
        tag = Tag.query.filter(Tag.title==request.form['selected_tag']).first()
        if tag != None:
            selected_tag = tag
            selected_tag = tag_select2(selected_tag.id)
        print("")
        print("IN update_std_txt tag = ", tag)
        print("IN update_std_txt selected_tag = ", selected_tag)
        

        if gt_id == 0: 
            print("")
            print("request.form['selected_ar']", request.form['selected_ar'])
            ar = Age_range.query.filter(Age_range.title==request.form['selected_ar']).first()
            if ar != None:
                selected_ar = ar
                selected_ar = age_range_select2(selected_ar.id)
            print("")
            print("IN update_std_txt ar = ", ar)
            print("IN update_std_txt selected_ar = ", selected_ar)
    
        return student_dsts()
        
    gt_id = int(request.form['txt_type_form_button_name'])
   
    gt = General_txt.query.filter(General_txt.id == gt_id).first() 
          
    std_gt = attach_gt_to_std(std.id, gt.id)
 
    std_gt = std_general_txt_select2(std.id, gt_id)    
   
    return update_std_txt()
                  

##############END update_std_txt ###############	
