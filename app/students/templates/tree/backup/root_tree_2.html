
{% extends "layout.html" %}

	
{% block content %}

{% with from_dst_sort_order=3 %} 
	{% include "dst_title.html" %} 
{% endwith %} 

<!-- from http://gojs.net/latest/samples/localView.html  -->
<!-- add a textbox for status from https://gojs.net/latest/intro/groups.html -->

<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Local View</title>
  <meta name="description" content="In one diagram show the whole tree and in a second diagram show a subset that is logically near a selected node." />
  <!-- Copyright 1998-2017 by Northwoods Software Corporation. -->
  <meta charset="UTF-8">
  <script src="../release/go.js"></script>
    <script src="../assets/js/goSamples.js"></script>  <!-- this is only for the GoJS Samples framework -->
  
  
  <!-- FROM https://gojs.net/latest/learn/index.html -->
  <script src="go-debug.js"></script>
  <!-- FROM https://gojs.net/latest/learn/index.html -->
   
 <script id="code">
    function init() {
		if (window.goSamples) goSamples();  // init for these samples -- you don't need to call this
		var $ = go.GraphObject.make;  // for conciseness in defining templates
		myFullDiagram =
		$(go.Diagram, "fullDiagram",  // each diagram refers to its DIV HTML element by id
		  {
			initialAutoScale: go.Diagram.UniformToFill,  // automatically scale down to show whole tree
			maxScale: 1,
			contentAlignment: go.Spot.Center,  // center the tree in the viewport
			isReadOnly: true,  // don't allow user to change the diagram
			"animationManager.isEnabled": false,
			layout: $(go.TreeLayout,
					  { angle: 90, sorting: go.TreeLayout.SortingAscending }),
			maxSelectionCount: 1,  // only one node may be selected at a time in each diagram
			// when the selection changes, update the myLocalDiagram view
		  });

		// Define a node template that is shared by both diagrams
		var myNodeTemplate =
			$(go.Node, "Auto",
			  { locationSpot: go.Spot.Center, },
			  new go.Binding("text", "key", go.Binding.toString),  // for sorting
			  
		<!-- FROM https://forum.nwoods.com/t/centering-textblocks-in-panels/7941/9  -->	

			$(go.Panel, "Vertical",
				new go.Binding("background", "color"),

						
					$(go.Picture,
						{ margin: 10, width: 50, height: 50, background: "red", alignment: go.Spot.Left, },
						new go.Binding("source")),
								
					$(go.TextBlock, {  margin: 5, stroke:"black", textAlign: "center", font: "bold 16px sans-serif" }, 
						new go.Binding("text", "name")),
						
					$(go.TextBlock, {  margin: 5, stroke:"black", textAlign: "center", font: "bold 16px sans-serif" }, 
						new go.Binding("text", "status"),
						new go.Binding("fill", "color2"),
						new go.Binding("stroke", "text_color")),
			)

		<!-- FROM https://forum.nwoods.com/t/centering-textblocks-in-panels/7941/9  -->			

		);

		myFullDiagram.nodeTemplate = myNodeTemplate;
		// Define a basic link template, not selectable, shared by both diagrams

		var myLinkTemplate =
		$(go.Link,
			{ routing: go.Link.Normal, selectable: false },
			$(go.Shape,
			{ strokeWidth: 2 })
		);


		myFullDiagram.linkTemplate = myLinkTemplate;
		// Create the full tree diagram
		setupDiagram();

		// Create the tree model containing TOTAL nodes, with each node having a variable number of children
		function setupDiagram(total) {
		
			
			if (total === undefined) total = '{{ total_gts }}';  // total should be the number of destinations
			var dstArray = [];
			var i=0;
			
			dstArray.push({ key: "{{ dest.id }}",  
						name: "{{ dest.title }}",
						//background: "{{ dest.title_color}}",
						source: "{{ url_for('static', filename='img/goal.png') }}"    } );//DEST

			i=1;		
			{% for goal in dst_goals %}  // GOALS
				
				console.log( {{goal}} );

				{% include "./tree/dst_data.js" %}
				
				dstArray[i].parent = 0;   // all the destinations parent is student
						
				var j=i+1;

				{% for todo in dst_todos if (goal.is_parent_of(todo)) %}  // TODOS			{% include "./tree/goal_data.js" %}
					dstArray[j].parent = dstArray[i].key;				
					j++;
				{% endfor %}  //GOALS		
				
				i=j;			
			{% endfor %}  // DESTINATIONS

			console.log(dstArray);
			
			var model = $(go.TreeModel);

			model.nodeDataArray = dstArray;
			myFullDiagram.model = model;
			
		}	

	}
	
</script>
  
  
</head>

<body onload="init()">

<div id="sample">
  <div id="fullDiagram" style="height:100%;width:100%;border:2px solid black;margin:2px;"></div>
</div>

</body>

</html>

{% endblock %}